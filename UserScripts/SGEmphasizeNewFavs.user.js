// ==UserScript==
// @name        SGEmphasizeNewFavs
// @namespace   https://twitter.com/11powder
// @description Stroll Greenで新規Favを強調する
// @include     /^http:\/\/st\.x0\.to\/\?mode=list.*?&seltype=2.*$/
// @version     1.0.1
// @updateURL   https://pejuta.github.io/SGTools/UserScripts/SGEmphasizeNewFavs.user.js
// @downloadURL https://pejuta.github.io/SGTools/UserScripts/SGEmphasizeNewFavs.user.js
// @grant       none
// ==/UserScript==
!function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=5)}([function(t,e,r){var n=r(1);"string"==typeof n&&(n=[[t.i,n,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};r(3)(n,o);n.locals&&(t.exports=n.locals)},function(t,e,r){(t.exports=r(2)(!1)).push([t.i,'.newfav > td:first-of-type::before {\r\n    display: block;\r\n    color: #ee7700;\r\n    content: "★New"\r\n}\r\n.newfav.odd {\r\n    background-color: #ffdd77;\r\n}\r\n.newfav.even {\r\n    background-color: #ffee88;\r\n}\r\n',""])},function(t,e,r){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var r=function(t,e){var r=t[1]||"",n=t[3];if(!n)return r;if(e&&"function"==typeof btoa){var o=(s=n,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(s))))+" */"),i=n.sources.map((function(t){return"/*# sourceURL="+n.sourceRoot+t+" */"}));return[r].concat(i).concat([o]).join("\n")}var s;return[r].join("\n")}(e,t);return e[2]?"@media "+e[2]+"{"+r+"}":r})).join("")},e.i=function(t,r){"string"==typeof t&&(t=[[null,t,""]]);for(var n={},o=0;o<this.length;o++){var i=this[o][0];null!=i&&(n[i]=!0)}for(o=0;o<t.length;o++){var s=t[o];null!=s[0]&&n[s[0]]||(r&&!s[2]?s[2]=r:r&&(s[2]="("+s[2]+") and ("+r+")"),e.push(s))}},e}},function(t,e,r){var n,o,i={},s=(n=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===o&&(o=n.apply(this,arguments)),o}),a=function(t,e){return e?e.querySelector(t):document.querySelector(t)},c=function(t){var e={};return function(t,r){if("function"==typeof t)return t();if(void 0===e[t]){var n=a.call(this,t,r);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}}(),u=null,l=0,d=[],f=r(4);function h(t,e){for(var r=0;r<t.length;r++){var n=t[r],o=i[n.id];if(o){o.refs++;for(var s=0;s<o.parts.length;s++)o.parts[s](n.parts[s]);for(;s<n.parts.length;s++)o.parts.push(w(n.parts[s],e))}else{var a=[];for(s=0;s<n.parts.length;s++)a.push(w(n.parts[s],e));i[n.id]={id:n.id,refs:1,parts:a}}}}function b(t,e){for(var r=[],n={},o=0;o<t.length;o++){var i=t[o],s=e.base?i[0]+e.base:i[0],a={css:i[1],media:i[2],sourceMap:i[3]};n[s]?n[s].parts.push(a):r.push(n[s]={id:s,parts:[a]})}return r}function p(t,e){var r=c(t.insertInto);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var n=d[d.length-1];if("top"===t.insertAt)n?n.nextSibling?r.insertBefore(e,n.nextSibling):r.appendChild(e):r.insertBefore(e,r.firstChild),d.push(e);else if("bottom"===t.insertAt)r.appendChild(e);else{if("object"!=typeof t.insertAt||!t.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var o=c(t.insertAt.before,r);r.insertBefore(e,o)}}function m(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t);var e=d.indexOf(t);e>=0&&d.splice(e,1)}function y(t){var e=document.createElement("style");if(void 0===t.attrs.type&&(t.attrs.type="text/css"),void 0===t.attrs.nonce){var n=function(){0;return r.nc}();n&&(t.attrs.nonce=n)}return v(e,t.attrs),p(t,e),e}function v(t,e){Object.keys(e).forEach((function(r){t.setAttribute(r,e[r])}))}function w(t,e){var r,n,o,i;if(e.transform&&t.css){if(!(i="function"==typeof e.transform?e.transform(t.css):e.transform.default(t.css)))return function(){};t.css=i}if(e.singleton){var s=l++;r=u||(u=y(e)),n=j.bind(null,r,s,!1),o=j.bind(null,r,s,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(r=function(t){var e=document.createElement("link");return void 0===t.attrs.type&&(t.attrs.type="text/css"),t.attrs.rel="stylesheet",v(e,t.attrs),p(t,e),e}(e),n=E.bind(null,r,e),o=function(){m(r),r.href&&URL.revokeObjectURL(r.href)}):(r=y(e),n=S.bind(null,r),o=function(){m(r)});return n(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;n(t=e)}else o()}}t.exports=function(t,e){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(e=e||{}).attrs="object"==typeof e.attrs?e.attrs:{},e.singleton||"boolean"==typeof e.singleton||(e.singleton=s()),e.insertInto||(e.insertInto="head"),e.insertAt||(e.insertAt="bottom");var r=b(t,e);return h(r,e),function(t){for(var n=[],o=0;o<r.length;o++){var s=r[o];(a=i[s.id]).refs--,n.push(a)}t&&h(b(t,e),e);for(o=0;o<n.length;o++){var a;if(0===(a=n[o]).refs){for(var c=0;c<a.parts.length;c++)a.parts[c]();delete i[a.id]}}}};var N,g=(N=[],function(t,e){return N[t]=e,N.filter(Boolean).join("\n")});function j(t,e,r,n){var o=r?"":n.css;if(t.styleSheet)t.styleSheet.cssText=g(e,o);else{var i=document.createTextNode(o),s=t.childNodes;s[e]&&t.removeChild(s[e]),s.length?t.insertBefore(i,s[e]):t.appendChild(i)}}function S(t,e){var r=e.css,n=e.media;if(n&&t.setAttribute("media",n),t.styleSheet)t.styleSheet.cssText=r;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(r))}}function E(t,e,r){var n=r.css,o=r.sourceMap,i=void 0===e.convertToAbsoluteUrls&&o;(e.convertToAbsoluteUrls||i)&&(n=f(n)),o&&(n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */");var s=new Blob([n],{type:"text/css"}),a=t.href;t.href=URL.createObjectURL(s),a&&URL.revokeObjectURL(a)}},function(t,e){t.exports=function(t){var e="undefined"!=typeof window&&window.location;if(!e)throw new Error("fixUrls requires window.location");if(!t||"string"!=typeof t)return t;var r=e.protocol+"//"+e.host,n=r+e.pathname.replace(/\/[^\/]*$/,"/");return t.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,(function(t,e){var o,i=e.trim().replace(/^"(.*)"$/,(function(t,e){return e})).replace(/^'(.*)'$/,(function(t,e){return e}));return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(i)?t:(o=0===i.indexOf("//")?i:0===i.indexOf("/")?r+i:n+i.replace(/^\.\//,""),"url("+JSON.stringify(o)+")")}))}},function(t,e,r){"use strict";r.r(e);var n=1,o="SGTools",i="YourFavs",s="newfav",a=function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function s(t){try{c(n.next(t))}catch(t){i(t)}}function a(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,a)}c((n=n.apply(t,e||[])).next())}))};class c{constructor(t,e){if(this.db=null,"name"in t)this.db=t,this.dbPromise=Promise.resolve(this.db),this.dbName=this.db.name,this.tableName=e,this.dbVersion=this.db.version;else{this.dbName=t.dbName,this.tableName=t.tableName,this.dbVersion=t.dbVersion,t.objectStoreParameters&&(this.objectStoreParameters=Object.freeze(Object.assign({},t.objectStoreParameters)))}}get DBPromise(){return this.dbPromise}get DBIsOpen(){return!!this.db}open(t){const e=indexedDB.open(this.dbName,this.dbVersion);return this.dbPromise=new Promise((r,n)=>{const o=this;e.onsuccess=function(t){o.db=this.result,r(o.db)},e.onerror=function(t){o.db=null,n("db error")},e.onupgradeneeded=function(e){const r=this.result;if(r.objectStoreNames.contains(o.tableName))t&&t(r,e);else{r.createObjectStore(o.tableName,o.objectStoreParameters)}r.onversionchange=t=>{r.close(),alert("データベースが更新されました。ページを再読込してください。")}},e.onblocked=function(t){n("blocked: db is already open.")}})}close(){var t;null===(t=this.db)||void 0===t||t.close()}count(t){if(!this.db)throw this.throwDBIsNotReadyError();const e=this.db.transaction(this.tableName,"readonly").objectStore(this.tableName).count(t);return new Promise((t,r)=>{e.onsuccess=function(e){t(this.result)},e.onerror=function(t){r("db error")}})}get(t){if(!this.db)throw this.throwDBIsNotReadyError();const e=this.db.transaction(this.tableName,"readonly").objectStore(this.tableName).get(t);return new Promise((t,r)=>{e.onsuccess=function(e){t(this.result)},e.onerror=function(t){r("db error")}})}getAll(t,e){if(!this.db)throw this.throwDBIsNotReadyError();const r=this.db.transaction(this.tableName,"readonly").objectStore(this.tableName).getAll(t,e);return new Promise((t,e)=>{r.onsuccess=function(e){t(this.result)},r.onerror=function(t){e("db error")}})}getAllDescending(t,e){return a(this,void 0,void 0,(function*(){const r=[];if(void 0===e)return yield this.iterate(t=>(r.push(t),!1),t,"prev"),r;let n=e;return n<=0?r:(yield this.iterate(t=>(r.push(t),0==--n),t,"prev"),r)}))}getKey(t){if(!this.db)throw this.throwDBIsNotReadyError();const e=this.db.transaction(this.tableName,"readonly").objectStore(this.tableName).getKey(t);return new Promise((t,r)=>{e.onsuccess=function(e){t(this.result)},e.onerror=function(t){r("db error")}})}getAllKeys(t,e){if(!this.db)throw this.throwDBIsNotReadyError();const r=this.db.transaction(this.tableName,"readonly").objectStore(this.tableName).getAllKeys(t,e);return new Promise((t,e)=>{r.onsuccess=function(e){t(this.result)},r.onerror=function(t){e("db error")}})}add(t,e){if(!this.db)throw this.throwDBIsNotReadyError();const r=this.db.transaction(this.tableName,"readwrite").objectStore(this.tableName);return this._add(r,t,e)}bulkAdd(t){if(!this.db)throw this.throwDBIsNotReadyError();const e=this.db.transaction(this.tableName,"readwrite").objectStore(this.tableName);return this._addMany(e,t)}put(t,e){if(!this.db)throw this.throwDBIsNotReadyError();const r=this.db.transaction(this.tableName,"readwrite").objectStore(this.tableName);return this._put(r,t,e)}bulkPut(t){if(!this.db)throw this.throwDBIsNotReadyError();const e=this.db.transaction(this.tableName,"readwrite").objectStore(this.tableName);return this._putMany(e,t)}delete(t){if(!this.db)throw this.throwDBIsNotReadyError();const e=this.db.transaction(this.tableName,"readwrite").objectStore(this.tableName);return this._delete(e,t)}bulkDelete(t){if(!this.db)throw this.throwDBIsNotReadyError();const e=this.db.transaction(this.tableName,"readwrite").objectStore(this.tableName);return this._deleteMany(e,t)}clear(){if(!this.db)throw this.throwDBIsNotReadyError();const t=this.db.transaction(this.tableName,"readwrite").objectStore(this.tableName);return this._clear(t)}replaceAll(t){return a(this,void 0,void 0,(function*(){if(!this.db)throw this.throwDBIsNotReadyError();const e=this.db.transaction(this.tableName,"readwrite").objectStore(this.tableName);return yield this._clear(e),yield this._addMany(e,t)}))}openCursor(t,e,r){if(!this.db)throw this.throwDBIsNotReadyError();return this.db.transaction(this.tableName,r).objectStore(this.tableName).openCursor(t,e)}openKeyCursor(t,e,r){if(!this.db)throw this.throwDBIsNotReadyError();return this.db.transaction(this.tableName,r).objectStore(this.tableName).openKeyCursor(t,e)}iterate(t,e,r,n){const o=this.openCursor(e,r,n);return new Promise((e,r)=>{o.onsuccess=function(r){const n=this.result;n?t(n.value,n)?e():n.continue():e()},o.onerror=function(t){r("db error")}})}iterateKey(t,e,r,n){const o=this.openKeyCursor(e,r,n);return new Promise((e,r)=>{o.onsuccess=function(r){const n=this.result;n?t(n.key,n)?e():n.continue():e()},o.onerror=function(t){r("db error")}})}_clear(t){const e=t.clear();return new Promise((t,r)=>{e.onsuccess=function(e){t()},e.onerror=function(t){r("db error")}})}_add(t,e,r){const n=t.add(e,r);return new Promise((t,e)=>{n.onsuccess=function(e){t(this.result)},n.onerror=function(t){e("db error")}})}_addMany(t,e){return a(this,void 0,void 0,(function*(){if(0===e.length)return[];const r=[];if(Array.isArray(e[0]))for(const n of e)r.push(yield this._add(t,n[1],n[0]));else for(const n of e)r.push(yield this._add(t,n));return r}))}_put(t,e,r){const n=t.put(e,r);return new Promise((t,e)=>{n.onsuccess=function(e){t(this.result)},n.onerror=function(t){e("db error")}})}_putMany(t,e){return a(this,void 0,void 0,(function*(){if(0===e.length)return[];const r=[];if(Array.isArray(e[0]))for(const n of e)r.push(yield this._put(t,n[1],n[0]));else for(const n of e)r.push(yield this._put(t,n));return r}))}_delete(t,e){if(!this.db)throw this.throwDBIsNotReadyError();const r=t.delete(e);return new Promise((t,e)=>{r.onsuccess=function(e){t()},r.onerror=function(t){e("db error")}})}_deleteMany(t,e){return a(this,void 0,void 0,(function*(){if(0!==e.length)for(const r of e)yield this._delete(t,r)}))}throwDBIsNotReadyError(){throw new Error("DBの準備が完了していません。Promiseを参照してDBが開けるまで待機してください。")}}r(0);(function(t,e,r,n){new(r||(r=Promise))((function(o,i){function s(t){try{c(n.next(t))}catch(t){i(t)}}function a(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,a)}c((n=n.apply(t,e||[])).next())}))})(void 0,void 0,void 0,(function*(){const t=document.getElementById("skill");if(!t)return;const e=Array.from(t.querySelectorAll("td:first-of-type"));let r,a="";try{r=new Map(e.map(t=>t.textContent).filter(t=>/^Eno\.(\d+)$/.test(t)).map((t,e)=>(a=t,[parseInt(t.slice(4),10),e])))}catch(t){throw new Error(`Eno parsing error; ${a} is not numeric.`)}const u=new c({dbName:o,tableName:i,dbVersion:n,objectStoreParameters:{keyPath:"eno",autoIncrement:!1}});yield u.open();try{const t=new Set(yield u.getAllKeys());for(let n of r.keys())t.has(n)||e[r.get(n)].parentElement.classList.add(s);yield u.bulkPut(Array.from(r.keys()).map(t=>({eno:t})))}finally{u.close()}}))}]);